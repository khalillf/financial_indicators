<div class="container mx-auto px-4 py-8">
  <div class="bg-gray-800 rounded-lg shadow-lg p-6">

    <!-- ‑‑‑ header ‑‑‑ -->
    <h2 class="text-2xl font-bold text-white mb-6 flex items-center gap-2">
      <i class="fa-solid fa-clipboard-list text-blue-400"></i>
      Fiche Portefeuille
    </h2>

    <!-- ‑‑‑ filters ‑‑‑ -->
    <form [formGroup]="searchForm" (ngSubmit)="loadData()" class="mb-6">
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <div>
          <label class="block text-sm font-medium text-gray-300 mb-1">Date</label>
          <input type="date" formControlName="date"
                 class="w-full bg-gray-700 border border-gray-600 rounded-md
                        py-2 px-3 text-white focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-300 mb-1">PTF</label>
          <input type="text" formControlName="ptf" placeholder="Enter PTF"
                 class="w-full bg-gray-700 border border-gray-600 rounded-md
                        py-2 px-3 text-white focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
        </div>
        <div class="flex items-end gap-2">
          <button type="submit"
                  class="bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded-md transition">
            Filter
          </button>
          <button type="button" (click)="resetFilters()"
                  class="bg-gray-600 hover:bg-gray-700 text-white py-2 px-4 rounded-md transition">
            Reset
          </button>
        </div>
      </div>
    </form>

    <!-- quick search -->
    <div class="mb-6">
      <div class="relative">
        <input type="text" formControlName="searchQuery"
               placeholder="Search by code or description…"
               (keyup.enter)="searchByCode()"
               class="w-full bg-gray-700 border border-gray-600 rounded-md
                      py-2 pl-10 pr-10 text-white focus:ring-2 focus:ring-blue-500">
        <i class="fa-solid fa-magnifying-glass text-gray-400 absolute left-3 top-2.5"></i>
        <button type="button" (click)="searchByCode()"
                class="absolute right-3 top-2.5 text-gray-400 hover:text-white">
          <i class="fa-solid fa-magnifying-glass"></i>
        </button>
      </div>
    </div>

    <!-- ‑‑‑ data table ‑‑‑ -->
    <div class="overflow-x-auto rounded-lg border border-gray-700">
      <table class="min-w-full divide-y divide-gray-700 text-sm">
        <!-- headers -->
        <thead class="bg-gray-700">
        <tr>
          <th *ngFor="let col of columns"
              class="px-4 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">
            {{ col.label }}
          </th>
        </tr>
        </thead>

        <tbody class="bg-gray-800 divide-y divide-gray-700">
        <!-- loading -->
        <tr *ngIf="isLoading">
          <td [attr.colspan]="columns.length" class="px-4 py-6 text-center text-gray-400">
            <i class="fa-solid fa-spinner animate-spin mr-2 text-blue-400"></i>
            Loading …
          </td>
        </tr>

        <!-- no data -->
        <tr *ngIf="!isLoading && filteredData.length === 0">
          <td [attr.colspan]="columns.length" class="px-4 py-6 text-center text-gray-400">
            No data found
          </td>
        </tr>

        <!-- rows -->
        <tr *ngFor="let row of filteredData"
            class="hover:bg-gray-700 transition-colors">
          <td *ngFor="let col of columns" class="px-4 py-2 whitespace-nowrap text-gray-200">
            <ng-container [ngSwitch]="col.fmt">
              <!-- date -->
              <span *ngSwitchCase="'date'">{{ row[col.key] | date:'yyyy-MM-dd' }}</span>

              <!-- percent (value already 0‑1) -->
              <span *ngSwitchCase="'percent'">{{ row[col.key] | percent:'1.2-2' }}</span>

              <!-- integer (1.0‑0) or decimal (1.2‑2) -->
              <span *ngSwitchCase="'1.0-0'">{{ row[col.key] | number:'1.0-0' }}</span>
              <span *ngSwitchCase="'1.2-2'">{{ row[col.key] | number:'1.2-2' }}</span>

              <!-- fallback -->
              <span *ngSwitchDefault>{{ row[col.key] }}</span>
            </ng-container>
          </td>
        </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>
