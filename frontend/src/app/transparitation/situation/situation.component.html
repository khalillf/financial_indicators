<div class="p-6 bg-white shadow-xl rounded-xl max-w-7xl mx-auto mt-6">
  <!-- Inputs -->
  <div class="flex flex-col md:flex-row gap-4 mb-6">
    <div class="w-full md:w-1/3">
      <label class="block text-sm mb-1">PTF</label>
      <input [(ngModel)]="ptf"
             class="p-3 border rounded-md w-full" />
    </div>

    <div class="w-full md:w-1/3">
      <label class="block text-sm mb-1">
        Start Date ({{ dateImage | date:'dd-MM-yyyy' }})
      </label>
      <input [(ngModel)]="dateImage" type="date"
             class="p-3 border rounded-md w-full" />
    </div>

    <div class="w-full md:w-1/3">
      <label class="block text-sm mb-1">
        End Date ({{ dateImageFin | date:'dd-MM-yyyy' }})
      </label>
      <input [(ngModel)]="dateImageFin" type="date"
             class="p-3 border rounded-md w-full" />
    </div>
  </div>

  <!-- Buttons -->
  <div class="flex flex-col md:flex-row gap-4 mb-6">
    <a [href]="'/transparisation?date=' + selectedDate + '&ptf=' + ptf"
       target="_blank"
       class="px-6 py-3 bg-blue-600 text-white rounded-md">
      Go to Transparisation
    </a>

    <button (click)="fetchData()"
            class="px-6 py-3 bg-green-600 text-white rounded-md">
      Calculer Avant Traitement
    </button>

    <button (click)="transpariseData()"
            class="px-6 py-3 bg-purple-600 text-white rounded-md">
      Transparise
    </button>
    <button (click)="saveAllTableData()"
            class="px-6 py-3 bg-red-600 text-white rounded-md">
      Save table data
    </button>
    <button class="px-4 py-2 bg-green-600 text-white rounded-md"
            (click)="goToGraphRatio()">
      Graph Ratio Réglementaire
    </button>

  </div>
  <!-- ────────────────────────────────────────────── -->
  <!-- 1)  DETAIL ROWS (isItem = true)               -->
  <!-- ────────────────────────────────────────────── -->
  <div class="overflow-auto border rounded-lg mb-10">
    <table class="min-w-full text-sm text-left border-collapse">
      <!-- identical THEAD as before -->
      <thead class="bg-gray-50">
      <tr>
        <th class="px-4 py-3 border">Date</th>
        <th class="px-4 py-3 border">Classe</th>
        <th class="px-4 py-3 border">Catégorie</th>
        <th class="px-4 py-3 border text-center" colspan="2">Avant retraitement</th>
        <th class="px-4 py-3 border text-center" colspan="2">Après retraitement</th>
      </tr>
      <tr class="bg-gray-100">
        <th colspan="3"></th>
        <th class="px-4 py-2 border">VC</th>
        <th class="px-4 py-2 border">VM</th>
        <th class="px-4 py-2 border">VC</th>
        <th class="px-4 py-2 border">VM</th>
      </tr>
      </thead>

      <tbody>
      <tr *ngFor="let row of itemRows"
          [ngClass]="{ 'bg-purple-50': row.isTransparise }">

        <!-- same 7 <td> cells you already have -->
        <td class="border px-4 py-2">{{ row.date }}</td>
        <td class="border px-4 py-2">Classe {{ row.classe }}</td>
        <td class="border px-4 py-2">{{ row.categorieTitre }}</td>

        <td class="border px-4 py-2 text-right">{{ row.vc | number:'1.2-2' }}</td>
        <td class="border px-4 py-2 text-right">{{ row.vm | number:'1.2-2' }}</td>
        <td class="border px-4 py-2 text-right">{{ row.apresVc | number:'1.2-2' }}</td>
        <td class="border px-4 py-2 text-right">{{ row.apresVm | number:'1.2-2' }}</td>
      </tr>
      </tbody>
    </table>
  </div>

  <!-- ────────────────────────────────────────────── -->
  <!-- 2)  TOTAL / RATIO / TOTAL PORTFEUILLE TABLE   -->
  <!-- ────────────────────────────────────────────── -->
  <div class="overflow-auto border rounded-lg">
    <table class="min-w-full text-sm text-left border-collapse">
      <thead class="bg-gray-50">
      <tr>
        <th class="px-4 py-3 border">Date</th>
        <th class="px-4 py-3 border">Classe</th>
        <th class="px-4 py-3 border">Catégorie</th>
        <th class="px-4 py-3 border text-center" colspan="2">Avant retraitement</th>
        <th class="px-4 py-3 border text-center" colspan="2">Après retraitement</th>
      </tr>
      <tr class="bg-gray-100">
        <th colspan="3"></th>
        <th class="px-4 py-2 border">VC</th>
        <th class="px-4 py-2 border">VM</th>
        <th class="px-4 py-2 border">VC</th>
        <th class="px-4 py-2 border">VM</th>
      </tr>
      </thead>

      <tbody>
      <tr *ngFor="let row of summaryRows"
          [ngClass]="{
            'bg-orange-100 font-semibold': row.isClassTotal,
            'bg-orange-50 italic': row.isClassRatio,
            'bg-blue-100 font-bold': row.isGrandTotal
          }">

        <!-- Date -->
        <td class="border px-4 py-2">{{ row.date }}</td>

        <!-- Classe or blank for Grand Total -->
        <td class="border px-4 py-2">
          <ng-container *ngIf="!row.isGrandTotal">Classe {{ row.classe }}</ng-container>
        </td>

        <!-- Catégorie -->
        <td class="border px-4 py-2">{{ row.categorieTitre }}</td>

        <!-- Avant VC -->
        <td class="border px-4 py-2 text-right">
          <ng-container *ngIf="row.isClassRatio; else avVc">
            <span class="text-red-600">{{ (row.ratioVc * 100) | number:'1.2-2' }}%</span>
          </ng-container>
          <ng-template #avVc>{{ row.vc | number:'1.2-2' }}</ng-template>
        </td>

        <!-- Avant VM -->
        <td class="border px-4 py-2 text-right">
          <ng-container *ngIf="row.isClassRatio; else avVm">
            <span class="text-red-600">{{ (row.ratioVm * 100) | number:'1.2-2' }}%</span>
          </ng-container>
          <ng-template #avVm>{{ row.vm | number:'1.2-2' }}</ng-template>
        </td>

        <!-- Après VC -->
        <td class="border px-4 py-2 text-right">
          <ng-container *ngIf="row.isClassRatio; else apVc">
            <span class="text-blue-600">{{ (row.ratioApresVc! * 100) | number:'1.2-2' }}%</span>
          </ng-container>
          <ng-template #apVc>{{ row.apresVc | number:'1.2-2' }}</ng-template>
        </td>

        <!-- Après VM -->
        <td class="border px-4 py-2 text-right">
          <ng-container *ngIf="row.isClassRatio; else apVm">
            <span class="text-blue-600">{{ (row.ratioApresVm! * 100) | number:'1.2-2' }}%</span>
          </ng-container>
          <ng-template #apVm>{{ row.apresVm | number:'1.2-2' }}</ng-template>
        </td>
      </tr>
      </tbody>
    </table>
  </div>
</div>
